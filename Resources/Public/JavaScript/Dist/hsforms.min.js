(function($){var PLUGIN_NS="hsForms",calColorCache={},Plugin=function(target,options){return this.$T=$(target),this._init(target,options),this.dimension="",($(window).on("resize orientationchange",function(func,wait,immediate){var timeout;return function(){var context=this,args=arguments,callNow=immediate&&!timeout;clearTimeout(timeout),timeout=setTimeout(function(){timeout=null,immediate||func.apply(context,args)},wait),callNow&&func.apply(context,args)}}($.proxy(this.onResize,this),250)),this.options=$.extend(!0,{DEBUG:!1},options),this)};Plugin.prototype.onResize=function(){$(document).trigger("resizeDebounced")},Plugin.prototype.validateMaxPersons=function(){var _this=this,target=this.$T;return $(target).on("input",".adults, .children",function(){var currentObj=$(this),maxpersons=parseInt(currentObj.data("maxpersons")),children=parseInt(target.find(".children").val()),adults=parseInt(target.find(".adults").val());adults+children>maxpersons&&(currentObj.val(currentObj.val()-1),toastr.clear(),toastr.info(_this.displayMessages.maxpersonsmsg))}),this.$T},Plugin.prototype.bindButtonEvents=function(){var target=this.$T,_this=this;$(target).on("click",".promocode-link",function(){$(this).next().toggle()}),0<this._getChildren(".hidden-rooms")&&$(".add-rooms",target).show(),$(target).on("click",".add-room",function(){$(".hidden-rooms",target).children(":first").appendTo(target.find(".rooms")),0==_this._getChildren(".hidden-rooms")&&$(".add-rooms",target).hide()}),$(target).on("click",".remove-room",function(){$(".rooms",target).children(":last").prependTo(target.find(".hidden-rooms")),0<_this._getChildren(".hidden-rooms")&&$(".add-rooms",target).show()}),$(target).on("click",".submit-btn",function(event){event.preventDefault(),_this.$form.submit()})},Plugin.prototype._getChildren=function(selector){var target=this.$T;return $(selector,target).children().length},Plugin.prototype._replaceVars=function(msg,data){for(var k in data)data.hasOwnProperty(k)&&(msg=msg.replace("{"+k+"}",data[k]));return msg},Plugin.prototype._getDayNames=function(){var $sunday=moment("01.11.2015","DD.MM.YYYY");$sunday.locale(this.lang);var $result=[];for($i=0;$i<this.daysAllowedArrival.length;$i++)1==this.daysAllowedArrival[$i]&&$result.push($sunday.clone().day($i).format("dddd"));return $result.join(", ")},Plugin.prototype._stopBootstrapFocus=function(e){e.stopPropagation()},Plugin.prototype.bindCal=function(){var target=this.$T,_this=this;for(i=1;i<=_this.restrictions.maxrooms;i++){if($("#input_de"+i+"-"+_this.uid).on("onm.cal.message",function(evt,messageType,messageKey){if(_this.displayMessages[messageType+"."+messageKey]){var msg=_this._replaceVars(_this.displayMessages[messageType+"."+messageKey],_this.restrictions);toastr.clear(),toastr.info(msg,"Hinweis:")}}),disableTheForm=!1,null!=_this.travelperiods[0]){var mStartDate=moment(_this.travelperiods[0][0],"YYYY-MM-DD"),mEndDate=moment(_this.travelperiods[0][1],"YYYY-MM-DD");if(mEndDate.diff(mStartDate,"days")>=_this.restrictions.minnights){if(mStartDate<moment()&&(mStartDate=moment()),Array.isArray(_this.daysAllowedArrival)){for(var firstDay=mStartDate.day(),daysPlus=0;7>daysPlus&&(7==firstDay&&(firstDay=0),1!=_this.daysAllowedArrival[firstDay]);daysPlus++)firstDay++;mStartDate.add(daysPlus,"days")}0<daysPlus&&$(".js-dayadjustmentnotice",target).length&&$(".js-dayadjustmentnotice",target).show();var dateSelector="#input_de"+i+"-"+_this.uid,$minWidth=$(dateSelector).closest(".bookingForm").outerWidth();0>=$minWidth&&($minWidth=200<=$("body").outerWidth()&&300>=$("body").outerWidth()?$("body").outerWidth()-30:300),$(dateSelector).onmCal({lang:_this.lang,position:"bottom-left",displayMonths:1,rangeToElement:$("#input_de_to"+i+"-"+_this.uid),minRange:_this.restrictions.minnights,maxRange:_this.restrictions.maxnights,popupRangeSelect:!0,dateRanges:_this.travelperiods,width:Math.min($minWidth,300),value:[mStartDate.format(_this.dateFormat),mStartDate.clone().add(_this.restrictions.minnights,"days").format(_this.dateFormat)]}).onmCal("resetValue",!0).on("onm.cal.popupShown",function(){$(document).on("focusin.bs.modal",_this._stopBootstrapFocus)}).on("onm.cal.created",function(e,container){$(".hsforms_legend",target).length&&$($(".hsforms_legend",target).get(0)).clone().appendTo($(".onm-cal",$(container)))}).on("onm.cal.monthChange",function(evt,startMonth,monthCount){_this.enableAPI&&_this.updateCalendarColors($(this),startMonth,monthCount)}).on("onm.cal.popupHidden",function(){$(document).off("focusin.bs.modal",_this._stopBootstrapFocus),$dayOfWeek=moment($(this).val(),_this.dateFormat).day(),Array.isArray(_this.daysAllowedArrival)&&!_this.daysAllowedArrival[$dayOfWeek]&&($(this).onmCal("resetValue",!0),toastr.clear(),toastr.error(_this.displayMessages["restriction.arrivalDay"].replace("{0}",_this._getDayNames()),"Hinweis:"))}),$("#input_de_to"+i+"-"+_this.uid).on("onm.cal.change",function(evt,rangeToDate){rangeToDate&&$(this).closest(".room-row").find(".booker-in-content").is(":visible")&&$(this).closest(".room-row").find(".booker-in-content").slideUp()})}else disableTheForm=!0}else disableTheForm=!0;disableTheForm&&_this.disableTheForm(target)}var updateOnResize=function(){if(ResponsiveBootstrapToolkit.is("xs")){if("xs"!=this.dimension)for(this.dimension="xs",i=1;i<=_this.restrictions.maxrooms;i++){var dateSelector="#input_de"+i+"-"+_this.uid,inContent=".row"+i+" .booker-in-content";$(dateSelector).onmCal("update",$.extend({},{lang:_this.lang,position:"bottom-left",displayMonths:1,rangeToElement:$("#input_de_to"+i+"-"+_this.uid),minRange:_this.restrictions.minnights,maxRange:_this.restrictions.maxnights,popupRangeSelect:!0,dateRanges:_this.travelperiods,width:Math.min($minWidth,300),value:[mStartDate.format(_this.dateFormat),mStartDate.clone().add(_this.restrictions.minnights,"days").format(_this.dateFormat)]},{position:$(inContent,target)})),$(inContent,target).is(":visible")&&$(inContent,target).slideUp()}}else if("no-xs"!=this.dimension){for(this.dimension="no-xs",i=1;i<=_this.restrictions.maxrooms;i++){var dateSelector="#input_de"+i+"-"+_this.uid;$(dateSelector).onmCal("update",{lang:_this.lang,position:"bottom-left",displayMonths:1,rangeToElement:$("#input_de_to"+i+"-"+_this.uid),minRange:_this.restrictions.minnights,maxRange:_this.restrictions.maxnights,popupRangeSelect:!0,dateRanges:_this.travelperiods,width:Math.min($minWidth,300),value:[mStartDate.format(_this.dateFormat),mStartDate.clone().add(_this.restrictions.minnights,"days").format(_this.dateFormat)]})}$(".booker-in-content").hide()}};$(document).on("resizeDebounced",updateOnResize),setTimeout(function(){updateOnResize()},1)},Plugin.prototype.updateCalendarColors=function($el,startMonth,monthCount){for(var month,target=this.$T,_this=this,setMonthColor=function(colorData){$.each(colorData,function(index,item){$el.onmCal("setDateElementColors",item.date,item.bgColor,item.fontColor)})},i=0;i<monthCount;i++)month=startMonth.clone().add(i,"months").format("YYYY-MM-DD"),calColorCache[_this.uid+month]?(setMonthColor(calColorCache[_this.uid+month]),console.info("Loaded calendar COLORS from CACHE.")):$.ajax({url:window.location.pathname,data:{type:"5001",dateString:moment(month,"YYYY-MM-DD").format("YYYY-MM-DD")},success:function(msg){var json=$.parseJSON(msg)._embedded.web_availability_color;calColorCache[_this.uid+json[0].date]=json,setMonthColor(json),console.info("Loaded calendar COLORS from API.")},error:function(){return console.error("hsforms - colors couldn't be fetched :-( "),!1}})},Plugin.prototype.disableTheForm=function(target){$(".submit-btn",target).removeClass("submit-btn").removeAttr("href")},Plugin.prototype.parseDate=function(selector){return moment(selector.val(),this.dateFormat)},Plugin.prototype.clearForm=function(){this.$targetForm.find("input[type=\"hidden\"]").each(function(){$(this).removeAttr("name")})},Plugin.prototype.handleForm=function(){var _this=this;this.$form.on("submit",function(event){event.preventDefault(),_this.process()})},Plugin.prototype.validateDates=function(){var target=this.$T,_this=this,selector="#"+target.attr("id");date1=$(".date1",selector+" .rooms");var datesAreFine=!0;return date1.each(function(){var start=_this.parseDate($(this)),end=_this.parseDate($(this).closest(".room-row").find(".date2"));end.isValid()&&start.isValid()||(console.log("somehow dates are not perfect."),datesAreFine=!1)}),datesAreFine},Plugin.prototype.process=function(){return!!this.validateDates()&&void(this.clearForm(),this.buildForm(),this.$targetForm.submit())},Plugin.prototype.clearForm=function(){this.$targetForm.empty()},Plugin.prototype.addInput=function(name,val){var _this=this;$("<input>").attr({type:"hidden",value:val,name:name}).appendTo(_this.$targetForm)},Plugin.prototype.buildForm=function(){var target=this.$T,_this=this,selector="#"+target.attr("id");if($(".date1",selector+" .rooms").each(function(index){var start=_this.parseDate($(this)),end=_this.parseDate($(this).closest(".room-row").find(".date2")),nights=end.diff(start,"days");_this.addInput("date"+(index+1),start.format("YYYY-MM-DD")),_this.addInput("nights"+(index+1),nights)}),$(".adults",selector+" .rooms").each(function(index){_this.addInput("adults"+(index+1),$(this).val())}),$(".promotion-code",selector).each(function(index){_this.addInput("promotioncode"+(index+1),$(this).val())}),$(".ratecode",selector).each(function(index){_this.addInput("ratecode"+(index+1),$(this).val())}),$(".segments",selector+" .rooms").each(function(index){var segment=$.trim($(this).val());segment&&_this.addInput("segment"+(index+1),$(this).val())}),$("div.hidden-fields input[type=hidden]",target).each(function(){_this.addInput($(this).attr("name"),$(this).val())}),0<this.keepParams){var urlParams=this.getQueryParams(),self=this,allowedParams=this.allowedParams,allowAll=!1;("all"==allowedParams[0]||0==allowedParams.length)&&(allowAll=!0),$.each(urlParams,function(key,value){(-1!==allowedParams.indexOf(key)||allowAll)&&self.addInput(key,value)})}_this._addChildrenFields(),_this.$targetForm.attr("action",_this.$form.attr("action"))},Plugin.prototype.getQueryParams=function(){var match,search=/([^&=]+)=?([^&]*)/g,decode=function(s){return decodeURIComponent(s.replace(/\+/g," "))},query=window.location.search.substring(1),urlParams={};if(match=search.exec(query),match)do urlParams[decode(match[1])]=decode(match[2]),match=search.exec(query);while(match);return urlParams},Plugin.prototype._addChildrenFields=function(){var target=this.$T,_this=this,selector="#"+target.attr("id"),i=1;$(".childrens-age-box",selector+" .rooms").each(function(){var fieldName="children"+i,ages=[];$(this).children().each(function(){ages.push(parseInt($(this).find("select.child-age").val()))}),0<ages.length&&_this.addInput(fieldName,"["+ages.join(",")+"]"),i++})},Plugin.prototype._init=function(target,options){this.restrictions=options.restrictions,this.displayMessages=options.displayMessages,this.travelperiods=options.travelperiods,this.daysAllowedArrival=options.daysAllowedArrival,this.dateFormat=options.dateFormat,this.keepParams=options.keepParams,this.allowedParams=options.allowedParams,this.$form=$(".bookingFormUI",target),this.$targetForm=this.$form.parent().find(".booking-form").first(),this.uid=options.uid,this.enableAPI=options.enableAPI,this.lang=options.lang,this.initResponsiveToolkit(),moment.locale(options.lang),this.createChildrenAgeFields(),this.validateMaxPersons(),this.bindButtonEvents(),this.bindCal(),this.handleForm()},Plugin.prototype.initResponsiveToolkit=function(){var visibilityDivs={xs:$("<div class=\"onm-d-block onm-d-sm-none\"></div>"),sm:$("<div class=\"onm-d-none onm-d-sm-block onm-d-md-none\"></div>"),md:$("<div class=\"onm-d-none onm-d-md-block onm-d-lg-none\"></div>"),lg:$("<div class=\"onm-d-none onm-d-lg-block onm-d-xl-none\"></div>"),xl:$("<div class=\"onm-d-none onm-d-xl-block\"></div>")};ResponsiveBootstrapToolkit.use("Custom",visibilityDivs)},Plugin.prototype._addChildAgeBox=function(ID,target){var childAgeBox=$(".js-child-age-template",target).children().first();$("#"+ID).append(childAgeBox.clone());var child=1;$("#"+ID).find("label").each(function(index,element){$(element).replaceWith($(element).get(0).outerHTML.replace("{0}",child)),child++})},Plugin.prototype.createChildrenAgeFields=function(){var target=this.$T,_this=this;$(".children",target).each(function(){var childrenBoxID=$(this).data("children-box-id");for(i=0;i<$(this).val();i++)_this._addChildAgeBox(childrenBoxID,target)}),$(".children",target).bind("change",function(){var childrenBoxID=$(this).data("children-box-id"),noOfChildrenHasToBe=$(this).val(),noOfChildrenRightNow=$("#"+childrenBoxID).children().length;let diff=noOfChildrenHasToBe-noOfChildrenRightNow;if(0<diff)for(i=0;i<diff;i++)_this._addChildAgeBox(childrenBoxID,target);else if(0>diff)for(i=0;i<Math.abs(diff);i++)$("#"+childrenBoxID).children().last().remove()})},Plugin.prototype.DLOG=function(){if(this.options.DEBUG&&console)for(var i in arguments)console.log(PLUGIN_NS+": ",arguments[i])},Plugin.prototype.DWARN=function(){this.options.DEBUG&&console&&console.warn(arguments)},$.fn[PLUGIN_NS]=function(methodOrOptions){if(!$(this).length)return $(this);var instance=$(this).data(PLUGIN_NS);if(instance&&0!=methodOrOptions.indexOf("_")&&instance[methodOrOptions]&&"function"==typeof instance[methodOrOptions])return instance[methodOrOptions](Array.prototype.slice.call(arguments,1));return"object"!=typeof methodOrOptions&&methodOrOptions?void(instance?0==methodOrOptions.indexOf("_")?$.error("Method "+methodOrOptions+" is private!"):$.error("Method "+methodOrOptions+" does not exist."):$.error("Plugin must be initialised before using method: "+methodOrOptions)):(instance=new Plugin($(this),methodOrOptions),$(this).data(PLUGIN_NS,instance),$(this))}})(jQuery);